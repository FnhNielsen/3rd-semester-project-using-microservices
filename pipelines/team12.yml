##############################
######## DON'T TOUCH #########
##############################

include:
  - project: semester-project-e2021/team-12/ci-cd
    ref: dev
    file: base_pipeline.yml

##############################
############ Jobs ############
##############################
### Build ###
build:compile:
  extends:
    - .build
    - .artifact
  script:
    - echo "compiling"
    - echo "compiling"

build:api_image:
  extends:
    - .build
    - .test_image
  needs:
    - build:compile
  variables:
    # Variables
    #
    # CI_CD_IMAGE_NAME: (string)
    #   Required
    # CI_CD_DOCKER_PATH: (string)
    #   Default: .
    # CI_CD_FILE_NAME: (string)
    #   Default: Dockerfile
    #
    CI_CD_IMAGE_NAME: api
    CI_CD_DOCKER_PATH: api

build:database_image:
  extends:
    - .build
    - .test_image
  needs:
    - build:compile
  variables:
    # Variables
    #
    # CI_CD_IMAGE_NAME: (string)
    #   Required
    # CI_CD_DOCKER_PATH: (string)
    #   Default: .
    # CI_CD_FILE_NAME: (string)
    #   Default: Dockerfile
    #
    CI_CD_IMAGE_NAME: database
    CI_CD_DOCKER_PATH: database

### Test ###
test:unit:
  extends: .unit
  needs:
    - build:api_image
    - build:database_image
  script:
    - echo "run unit test cmds or script"
    - echo "run unit test cmds or script"

test:acceptance:
  extends: .acceptance
  needs:
    - test:unit
  script:
    - echo "run acceptance test cmds or script"
    - echo "run acceptance test cmds or script"

test:integration:
  extends: .integration
  needs:
    - test:acceptance
  script:
    - echo "run integration test cmds or script"
    - echo "run integration test cmds or script"

test:performance:
  extends: .performance
  needs:
    - test:integration
  script:
    - echo "run performance test cmds or script"
    - echo "run performance test cmds or script"

### Deliver ###
deliver:production_api_image:
  extends:
    - .deliver
    - .production_image
  variables:
    # Variable
    #
    # CI_CD_IMAGE_NAME: (string)
    #   Required
    #
    CI_CD_IMAGE_NAME: api

deliver:production_database_image:
  extends:
    - .deliver
    - .production_image
  variables:
    # Variable
    #
    # CI_CD_IMAGE_NAME: (string)
    #   Required
    #
    CI_CD_IMAGE_NAME: database

